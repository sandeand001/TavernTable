<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Sprite Debug</title>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@7.x/dist/pixi.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #2c2c2c; color: white; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #555; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        button { margin: 5px; padding: 5px 10px; }
        #canvas-container { margin: 20px 0; }
        #log { background: #1e1e1e; padding: 10px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>ðŸ”¬ Sprite Loading Diagnostic Tool</h1>
    
    <div class="test-section">
        <h2>1. File Accessibility Test</h2>
        <div id="file-test-results"></div>
        <button onclick="testFileAccess()">Test All Sprite Files</button>
    </div>
    
    <div class="test-section">
        <h2>2. PIXI Assets Loading Test</h2>
        <div id="pixi-test-results"></div>
        <button onclick="testPixiLoading()">Test PIXI Loading</button>
    </div>
    
    <div class="test-section">
        <h2>3. Sprite Creation Test</h2>
        <div id="sprite-test-results"></div>
        <button onclick="testSpriteCreation()">Test Sprite Creation</button>
        <div id="canvas-container"></div>
    </div>
    
    <div class="test-section">
        <h2>4. System Integration Test</h2>
        <div id="integration-test-results"></div>
        <button onclick="testSystemIntegration()">Test Full System</button>
    </div>
    
    <div class="test-section">
        <h2>Debug Log</h2>
        <div id="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        const sprites = {
            'beholder-sprite': 'assets/sprites/beholder-sprite.png',
            'dragon-sprite': 'assets/sprites/dragon-sprite.png',
            'goblin-sprite': 'assets/sprites/goblin-sprite.png',
            'mindflayer-sprite': 'assets/sprites/mindflayer-sprite.png',
            'minotaur-sprite': 'assets/sprites/minotaur-sprite.png',
            'orc-sprite': 'assets/sprites/orc-sprite.png',
            'owlbear-sprite': 'assets/sprites/owlbear-sprite.png',
            'skeleton-sprite': 'assets/sprites/skeleton-sprite.png',
            'troll-sprite': 'assets/sprites/troll-sprite.png'
        };
        
        let app = null;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        async function testFileAccess() {
            const results = document.getElementById('file-test-results');
            results.innerHTML = '<p>Testing file accessibility...</p>';
            
            const testResults = [];
            
            for (const [name, path] of Object.entries(sprites)) {
                try {
                    const response = await fetch(path, { method: 'HEAD' });
                    if (response.ok) {
                        testResults.push(`<span class="success">âœ“ ${name}: ${path} (${response.status})</span>`);
                        log(`âœ“ File accessible: ${name} -> ${path}`, 'success');
                    } else {
                        testResults.push(`<span class="error">âœ— ${name}: ${path} (${response.status})</span>`);
                        log(`âœ— File not accessible: ${name} -> ${path} (${response.status})`, 'error');
                    }
                } catch (error) {
                    testResults.push(`<span class="error">âœ— ${name}: ${path} (Error: ${error.message})</span>`);
                    log(`âœ— Error accessing: ${name} -> ${path} (${error.message})`, 'error');
                }
            }
            
            results.innerHTML = testResults.join('<br>');
        }
        
        async function testPixiLoading() {
            const results = document.getElementById('pixi-test-results');
            results.innerHTML = '<p>Testing PIXI Assets loading...</p>';
            
            try {
                // Clear any existing assets
                if (PIXI.Assets && PIXI.Assets._resolver && PIXI.Assets._resolver._assetMap) {
                    PIXI.Assets._resolver._assetMap.clear();
                }
                
                // Register all sprites
                for (const [name, path] of Object.entries(sprites)) {
                    log(`Registering PIXI asset: ${name} -> ${path}`);
                    PIXI.Assets.add(name, path);
                }
                
                // Load all sprites
                const spriteNames = Object.keys(sprites);
                log(`Loading ${spriteNames.length} sprites...`);
                
                const loadResults = [];
                
                for (const spriteName of spriteNames) {
                    try {
                        const texture = await PIXI.Assets.load(spriteName);
                        if (texture && texture.width && texture.height) {
                            loadResults.push(`<span class="success">âœ“ ${spriteName}: ${texture.width}x${texture.height}</span>`);
                            log(`âœ“ PIXI loaded: ${spriteName} (${texture.width}x${texture.height})`, 'success');
                        } else {
                            loadResults.push(`<span class="error">âœ— ${spriteName}: Invalid texture</span>`);
                            log(`âœ— PIXI failed: ${spriteName} - Invalid texture`, 'error');
                        }
                    } catch (error) {
                        loadResults.push(`<span class="error">âœ— ${spriteName}: ${error.message}</span>`);
                        log(`âœ— PIXI error: ${spriteName} - ${error.message}`, 'error');
                    }
                }
                
                results.innerHTML = loadResults.join('<br>');
                
            } catch (error) {
                results.innerHTML = `<span class="error">PIXI loading failed: ${error.message}</span>`;
                log(`âœ— PIXI loading system error: ${error.message}`, 'error');
            }
        }
        
        async function testSpriteCreation() {
            const results = document.getElementById('sprite-test-results');
            const container = document.getElementById('canvas-container');
            
            // Create PIXI app if it doesn't exist
            if (!app) {
                app = new PIXI.Application({
                    width: 800,
                    height: 400,
                    backgroundColor: 0x2c2c2c
                });
                container.innerHTML = '';
                container.appendChild(app.view);
                log('Created PIXI application');
            }
            
            // Clear stage
            app.stage.removeChildren();
            
            results.innerHTML = '<p>Testing sprite creation...</p>';
            
            const creationResults = [];
            let x = 50;
            
            for (const spriteName of Object.keys(sprites)) {
                try {
                    const texture = PIXI.Assets.get(spriteName);
                    if (texture) {
                        const sprite = new PIXI.Sprite(texture);
                        sprite.anchor.set(0.5, 0.5);
                        sprite.scale.set(0.1, 0.1);
                        sprite.x = x;
                        sprite.y = 200;
                        app.stage.addChild(sprite);
                        
                        creationResults.push(`<span class="success">âœ“ ${spriteName}: Sprite created and displayed</span>`);
                        log(`âœ“ Sprite created: ${spriteName}`, 'success');
                        x += 80;
                    } else {
                        creationResults.push(`<span class="error">âœ— ${spriteName}: No texture available</span>`);
                        log(`âœ— No texture for sprite: ${spriteName}`, 'error');
                    }
                } catch (error) {
                    creationResults.push(`<span class="error">âœ— ${spriteName}: ${error.message}</span>`);
                    log(`âœ— Sprite creation error: ${spriteName} - ${error.message}`, 'error');
                }
            }
            
            results.innerHTML = creationResults.join('<br>');
        }
        
        async function testSystemIntegration() {
            const results = document.getElementById('integration-test-results');
            results.innerHTML = '<p>Testing system integration...</p>';
            
            // Test GameConfig loading
            let configTest = '<span class="error">âœ— GameConfig not loaded</span>';
            try {
                const response = await fetch('./js/config/GameConfig.js');
                if (response.ok) {
                    const configCode = await response.text();
                    if (configCode.includes('GameConfig')) {
                        configTest = '<span class="success">âœ“ GameConfig file accessible</span>';
                    }
                }
            } catch (error) {
                configTest = `<span class="error">âœ— GameConfig error: ${error.message}</span>`;
            }
            
            // Test SpriteManager loading
            let spriteManagerTest = '<span class="error">âœ— SpriteManager not loaded</span>';
            try {
                const response = await fetch('./js/SpriteManager.js');
                if (response.ok) {
                    const smCode = await response.text();
                    if (smCode.includes('SpriteManager')) {
                        spriteManagerTest = '<span class="success">âœ“ SpriteManager file accessible</span>';
                    }
                }
            } catch (error) {
                spriteManagerTest = `<span class="error">âœ— SpriteManager error: ${error.message}</span>`;
            }
            
            // Test CreatureToken loading
            let creatureTokenTest = '<span class="error">âœ— CreatureToken not loaded</span>';
            try {
                const response = await fetch('./js/creatures/CreatureToken.js');
                if (response.ok) {
                    const ctCode = await response.text();
                    if (ctCode.includes('CreatureToken')) {
                        creatureTokenTest = '<span class="success">âœ“ CreatureToken file accessible</span>';
                    }
                }
            } catch (error) {
                creatureTokenTest = `<span class="error">âœ— CreatureToken error: ${error.message}</span>`;
            }
            
            results.innerHTML = [
                configTest,
                spriteManagerTest,
                creatureTokenTest
            ].join('<br>');
        }
        
        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            log('Diagnostic tool loaded');
        });
    </script>
</body>
</html>
